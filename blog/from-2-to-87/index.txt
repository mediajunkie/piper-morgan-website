1:"$Sreact.fragment"
8:I[8393,[],""]
:HL["/_next/static/css/f9342e94655f11e9.css","style"]
2:T1313,
            :root{--primary-teal:#2DD4BF;--primary-teal-text:#0D9488;--text-dark:#1F2937;--text-light:#6B7280;--background:#FFFFFF;--surface:#F9FAFB}
            .dark{--text-dark:#F1F5F9;--text-light:#94A3B8;--background:#0F172A;--surface:#1E293B}
            @font-face{font-family:'Inter';src:url('/fonts/inter-latin.woff2') format('woff2');font-weight:100 900;font-style:normal;font-display:swap;unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}
            *{box-sizing:border-box}
            html{scroll-behavior:smooth;font-size:16px;margin:0;padding:0;border:none;outline:none}
            body{background:var(--background);color:var(--text-dark);font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell',sans-serif;line-height:1.6;margin:0;padding:0;border:none;outline:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
            nav{border:none !important;outline:none !important}
            h1,h2,h3,h4,h5,h6{font-family:'Hoss Round','Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}
            p,span{max-width:75ch;line-height:1.7}
            .text-content div{max-width:75ch;line-height:1.7}
            .text-content{max-width:65ch}
            @media (max-width:640px){
              h1{font-size:1.75rem;line-height:1.2}
              h2{font-size:1.25rem;line-height:1.3}
              h3{font-size:1.1rem;line-height:1.4}
              h4{font-size:1rem;line-height:1.4}
            }
            @media (min-width:641px) and (max-width:768px){
              h1{font-size:2rem;line-height:1.2}
              h2{font-size:1.5rem;line-height:1.3}
              h3{font-size:1.25rem;line-height:1.4}
            }
            @media (prefers-reduced-motion: reduce){
              *{animation-duration:0.01ms !important;animation-iteration-count:1 !important;transition-duration:0.01ms !important}
            }
            a:hover{color:#0D9488;transition:color 0.2s ease}
            .hover-lift:hover{transform:translateY(-2px);transition:transform 0.2s ease}
            button:focus,a:focus{outline:2px solid #2DD4BF;outline-offset:2px;border-radius:4px}
            .skip-to-content{position:absolute;top:-100px;left:0;z-index:999;padding:8px 16px;background:#1F2937;color:white;text-decoration:none;border-radius:0 0 4px 0;transition:top 0.3s}
            .skip-to-content:focus{top:0;outline:2px solid #2DD4BF;outline-offset:2px}
            .section-spacing{margin-bottom:4rem}
            .component-spacing{margin-bottom:1.5rem}
            .micro-spacing{margin-bottom:0.5rem}
            @media (min-width:768px){
              .section-spacing{margin-bottom:6rem}
              .component-spacing{margin-bottom:2rem}
            }
            .site-container{width:100%;max-width:1200px;margin-left:auto;margin-right:auto;padding-left:1rem;padding-right:1rem}
            @media (min-width:640px){.site-container{padding-left:1.5rem;padding-right:1.5rem}}
            @media (min-width:768px){.site-container{padding-left:2rem;padding-right:2rem}}
            @media (min-width:1024px){.site-container{max-width:1200px}}
            @media (min-width:1200px){.site-container{max-width:1200px}}
            .section-padding{padding-top:4rem;padding-bottom:4rem}
            @media (min-width:768px){.section-padding{padding-top:5rem;padding-bottom:5rem}}
            .mx-auto{margin-left:auto;margin-right:auto}
            .max-w-4xl{max-width:56rem}
            .pt-16{padding-top:4rem}
            .pb-8{padding-bottom:2rem}
            .px-4{padding-left:1rem;padding-right:1rem}
            .mb-6{margin-bottom:1.5rem}
            .mb-8{margin-bottom:2rem}
            .text-left{text-align:left}
            .text-center{text-align:center}
            .text-primary-teal-text{color:#0F766E}
            .text-text-dark{color:#1F2937}
            .text-text-light{color:#6B7280}
            .font-bold{font-weight:700}
            .text-4xl{font-size:2.25rem;line-height:2.5rem}
            .text-5xl{font-size:3rem;line-height:1}
            .text-6xl{font-size:3.75rem;line-height:1}
            .text-lg{font-size:1.125rem;line-height:1.75rem}
            .text-xl{font-size:1.25rem;line-height:1.75rem}
            .leading-tight{line-height:1.25}
            .leading-relaxed{line-height:1.625}
            .min-h-screen{min-height:100vh}
            @media (min-width:768px){
              .md\:pt-24{padding-top:6rem}
              .md\:pb-12{padding-bottom:3rem}
              .md\:text-5xl{font-size:3rem;line-height:1}
              .md\:text-xl{font-size:1.25rem;line-height:1.75rem}
            }
            @media (min-width:1024px){
              .lg\:text-6xl{font-size:3.75rem;line-height:1}
            }
          0:{"P":null,"b":"FDvoXZJ_3caFysOy_3tjy","p":"","c":["","blog","from-2-to-87",""],"i":false,"f":[[["",{"children":["blog",{"children":[["slug","from-2-to-87","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/f9342e94655f11e9.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","className":"font-inter","children":[["$","head",null,{"children":[["$","script",null,{"dangerouslySetInnerHTML":{"__html":"\n              (function() {\n                const theme = localStorage.getItem('theme') ||\n                  (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');\n                if (theme === 'dark') {\n                  document.documentElement.classList.add('dark');\n                  document.body.classList.add('dark');\n                }\n              })();\n            "}}],["$","link",null,{"rel":"dns-prefetch","href":"//pipermorgan.ai"}],["$","link",null,{"rel":"preconnect","href":"https://pipermorgan.ai"}],["$","link",null,{"rel":"preload","as":"image","href":"/assets/pm-logo.png"}],["$","link",null,{"rel":"preload","href":"/fonts/inter-latin.woff2","as":"font","type":"font/woff2","crossOrigin":"anonymous"}],["$","link",null,{"rel":"preload","href":"/fonts/HossRound-Regular.woff2","as":"font","type":"font/woff2","crossOrigin":"anonymous"}],["$","style",null,{"dangerouslySetInnerHTML":{"__html":"$2"}}]]}],"$L3"]}]]}],{"children":["blog","$L4",{"children":[["slug","from-2-to-87","d"],"$L5",{"children":["__PAGE__","$L6",{},null,false]},null,false]},null,false]},null,false],"$L7",false]],"m":"$undefined","G":["$8",[]],"s":false,"S":true}
9:I[9119,["874","static/chunks/874-668c89038fa04eb8.js","212","static/chunks/212-369ef96a260e510f.js","177","static/chunks/app/layout-9ed54623e803ece8.js"],"ClientLayout"]
a:I[7555,[],""]
b:I[1295,[],""]
c:I[6874,["874","static/chunks/874-668c89038fa04eb8.js","212","static/chunks/212-369ef96a260e510f.js","144","static/chunks/144-1b443e029a921717.js","674","static/chunks/674-5f2fa3597c066943.js","831","static/chunks/app/blog/page-666765c672eae567.js"],""]
10:I[9665,[],"OutletBoundary"]
12:I[4911,[],"AsyncMetadataOutlet"]
14:I[9665,[],"ViewportBoundary"]
16:I[9665,[],"MetadataBoundary"]
17:"$Sreact.suspense"
3:["$","body",null,{"className":"font-sans antialiased","children":[["$","$L9",null,{"children":["$","$La",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$Lb",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","div",null,{"className":"min-h-screen","children":["$","div",null,{"className":"site-container max-w-4xl pt-16 md:pt-24 pb-8 md:pb-12 text-center","children":[["$","div",null,{"className":"mb-8","children":[["$","h1",null,{"className":"text-8xl md:text-9xl font-bold text-primary-teal-text mb-4","children":"404"}],["$","h2",null,{"className":"text-3xl md:text-4xl font-semibold text-text-dark mb-4","children":"Page Not Found"}],["$","p",null,{"className":"text-xl text-text-light leading-relaxed max-w-2xl mx-auto","children":"Looks like this page got lost in the AI training data. Don't worry ‚Äì even the best algorithms make mistakes sometimes."}]]}],["$","div",null,{"className":"mb-12","children":[["$","h3",null,{"className":"text-xl font-semibold text-text-dark mb-6","children":"Where would you like to go instead?"}],["$","div",null,{"className":"grid md:grid-cols-2 gap-6 max-w-2xl mx-auto","children":[["$","div",null,{"className":"space-y-4","children":[["$","$Lc",null,{"href":"/","className":"block p-4 bg-surface rounded-card hover:bg-gray-50 transition-colors group","children":[["$","h4",null,{"className":"font-semibold text-text-dark group-hover:text-primary-teal-text","children":"üè† Homepage"}],["$","p",null,{"className":"text-sm text-text-light mt-1","children":"Start from the beginning of our AI PM journey"}]]}],["$","$Lc",null,{"href":"/how-it-works","className":"block p-4 bg-surface rounded-card hover:bg-gray-50 transition-colors group","children":[["$","h4",null,{"className":"font-semibold text-text-dark group-hover:text-primary-teal-text","children":"‚öôÔ∏è How It Works"}],["$","p",null,{"className":"text-sm text-text-light mt-1","children":"Discover our AI-powered product management methodology"}]]}]]}],["$","div",null,{"className":"space-y-4","children":[["$","$Lc",null,{"href":"/what-weve-learned","className":"block p-4 bg-surface rounded-card hover:bg-gray-50 transition-colors group","children":[["$","h4",null,{"className":"font-semibold text-text-dark group-hover:text-primary-teal-text","children":"üí° What We've Learned"}],["$","p",null,{"className":"text-sm text-text-light mt-1","children":"Building-in-public insights and breakthroughs"}]]}],["$","$Lc",null,{"href":"/blog","className":"block p-4 bg-surface rounded-card hover:bg-gray-50 transition-colors group","children":[["$","h4",null,{"className":"font-semibold text-text-dark group-hover:text-primary-teal-text","children":"üìù Journey"}],["$","p",null,{"className":"text-sm text-text-light mt-1","children":"Follow our building-in-public blog posts"}]]}],["$","$Lc",null,{"href":"/get-involved","className":"block p-4 bg-surface rounded-card hover:bg-gray-50 transition-colors group","children":[["$","h4",null,{"className":"font-semibold text-text-dark group-hover:text-primary-teal-text","children":"üöÄ Get Involved"}],["$","p",null,{"className":"text-sm text-text-light mt-1","children":"Join our community and stay updated"}]]}]]}]]}]]}],["$","div",null,{"className":"text-center","children":[["$","p",null,{"className":"text-text-light mb-6","children":"Still can't find what you're looking for?"}],["$","$Lc",null,{"href":"/get-involved","className":"inline-flex items-center justify-center font-semibold transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:transform-none bg-primary-teal text-white hover:bg-teal-600 focus:ring-primary-teal shadow-component hover:shadow-component-hover hover:-translate-y-0.5 hover:scale-105 font-bold text-lg px-8 py-4 text-lg rounded-button","aria-label":"$undefined","children":[false,"Get Help & Stay Updated"]}]]}],["$","div",null,{"className":"mt-12 p-6 bg-gray-50 rounded-card max-w-lg mx-auto","children":["$","p",null,{"className":"text-sm text-text-light italic","children":["üí¨ ","$Ld"," \"Even the most sophisticated neural networks occasionally return null. Let's navigate back to more productive paths together!\""]}]}]]}]}],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}],"$Le"]}]
4:["$","$1","c",{"children":[null,["$","$La",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$Lb",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}]
5:["$","$1","c",{"children":[null,["$","$La",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$Lb",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}]
6:["$","$1","c",{"children":["$Lf",null,["$","$L10",null,{"children":["$L11",["$","$L12",null,{"promise":"$@13"}]]}]]}]
7:["$","$1","h",{"children":[null,[["$","$L14",null,{"children":"$L15"}],null],["$","$L16",null,{"children":["$","div",null,{"hidden":true,"children":["$","$17",null,{"fallback":null,"children":"$L18"}]}]}]]}]
19:I[9795,["874","static/chunks/874-668c89038fa04eb8.js","212","static/chunks/212-369ef96a260e510f.js","177","static/chunks/app/layout-9ed54623e803ece8.js"],"default"]
d:["$","strong",null,{"children":"Piper Morgan says:"}]
e:["$","$L19",null,{}]
1a:I[7887,["874","static/chunks/874-668c89038fa04eb8.js","953","static/chunks/app/blog/%5Bslug%5D/page-63f1c4c60df8aece.js"],"BlogPostContent"]
1b:T40b2,<section name="44d4" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="23aa" id="23aa" class="graf graf--h3 graf--leading graf--title">From 2% to 87%: The Great Test Suite¬†Recovery</h3><figure name="26f4" id="26f4" class="graf graf--figure graf--startsWithDoubleQuote graf-after--h3"><img class="graf-image" data-image-id="1*DX6049KTiHXt5TFDdbmeFg.png" data-width="1536" data-height="1024" data-is-featured="true" alt="A robot doctor and a human doctor watch over a patient who has made a full recovery." src="https://cdn-images-1.medium.com/max/800/1*DX6049KTiHXt5TFDdbmeFg.png"><figcaption class="imageCaption">‚ÄúYou‚Äôre going¬†home!‚Äù</figcaption></figure><p name="7b90" id="7b90" class="graf graf--p graf-after--figure"><em class="markup--em markup--p-em">July 13</em></p><p name="c843" id="c843" class="graf graf--p graf--hasDropCapModel graf--hasDropCap graf-after--p"><span class="graf-dropCap">T</span>here‚Äôs a special kind of despair that comes with seeing your test suite report 144 failures and 19 errors out of 204 total tests. A 2% pass rate isn‚Äôt just broken‚Ää‚Äî‚Ääit‚Äôs catastrophically broken. It‚Äôs the kind of number that makes you question whether you should just delete everything and start over.</p><p name="41c9" id="41c9" class="graf graf--p graf-after--p">The day I wrote this, we climbed out of that hole, ending the day at 87% pass rate (177/204 tests passing). The journey from software disaster to mostly-working system taught me more about test infrastructure than three years of ‚Äútesting best practices‚Äù blog posts.</p><h3 name="8415" id="8415" class="graf graf--h3 graf-after--p">The foundation: pre-commit hooks</h3><p name="7789" id="7789" class="graf graf--p graf-after--h3">The recovery actually started three days earlier with something mundane: setting up pre-commit hooks. I had been griping about needing to remember to update documentation every time we changed the code and my colleague at Kind, lead engineer Grace Xu, told me about the concept of pre-commit hooks.</p><p name="39a0" id="39a0" class="graf graf--p graf-after--p">Yes, I have worked in technology all my life and am still learning quotidian programming concepts daily.</p><p name="191d" id="191d" class="graf graf--p graf-after--p">I asked Claude to set some up and it configured black, flake8, isort, and other code quality tools to run automatically on every commit. It also reminds us to update documentation based on which files we changed.</p><p name="acee" id="acee" class="graf graf--p graf-after--p">This seemed like procrastination at the time‚Ää‚Äî‚Ääwhy format code when core functionality is broken? But it turned out to be essential. When you‚Äôre fixing 144 test failures, you need every bit of consistency and clarity you can get. Code formatting issues become cognitive overhead you can‚Äôt afford.</p><p name="6dc3" id="6dc3" class="graf graf--p graf-after--p">(At least that‚Äôs what I told myself. It is also possible I was being a digital magpie and just grabbing and absorbing every shiny new idea into my process.)</p><p name="d94e" id="d94e" class="graf graf--p graf-after--p">The pre-commit setup also revealed something important: we had 318 files that needed formatting fixes. That‚Äôs not a small project‚Ää‚Äî‚Ääthat‚Äôs a sign of technical debt accumulation that was making everything harder to understand and debug.</p><h3 name="abcb" id="abcb" class="graf graf--h3 graf-after--p">The horror of 144¬†failures</h3><p name="2e37" id="2e37" class="graf graf--p graf-after--h3">Sunday morning, July 13. Fresh coffee, good intentions, and a test command that delivered soul-crushing results:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="diff" name="fd18" id="fd18" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-comment">======================== 144 failed, 37 passed, 21 skipped, 19 errors ========================</span></span></pre><p name="724c" id="724c" class="graf graf--p graf-after--pre">Two percent. The kind of failure rate that suggests fundamental infrastructure problems, not minor bugs.</p><p name="02f5" id="02f5" class="graf graf--p graf-after--p">The failures fell into categories that told a story:</p><ul class="postList"><li name="b7a4" id="b7a4" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">AsyncSession leaks</strong>‚Ää‚Äî‚ÄäDatabase sessions not being closed properly</li><li name="8fff" id="8fff" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Missing pytest-asyncio configuration</strong>‚Ää‚Äî‚ÄäAsync tests failing because pytest couldn‚Äôt run them</li><li name="d3c0" id="d3c0" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Fixture drift</strong>‚Ää‚Äî‚ÄäTests expecting fixtures that no longer existed</li><li name="e469" id="e469" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Contract violations</strong>‚Ää‚Äî‚ÄäComponents expecting interfaces that had changed</li><li name="1aa1" id="1aa1" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Float precision errors</strong>‚Ää‚Äî‚ÄäTests comparing floats with exact equality</li></ul><p name="23e6" id="23e6" class="graf graf--p graf-after--li">Each category represented weeks of accumulated technical debt coming due all at once.</p><h3 name="5b84" id="5b84" class="graf graf--h3 graf-after--p">The systematic triage¬†approach</h3><p name="1749" id="1749" class="graf graf--p graf-after--h3">Rather than randomly fixing tests, we took a systematic approach:</p><h4 name="4e80" id="4e80" class="graf graf--h4 graf-after--p">Phase 1: Infrastructure fixes (the foundation)</h4><p name="b1e2" id="b1e2" class="graf graf--p graf-after--h4"><strong class="markup--strong markup--p-strong">The async session leak discovery</strong>: The most critical issue was database sessions not being closed properly in the query intent handler. This was causing cascading failures as tests shared database state.</p><p name="0486" id="0486" class="graf graf--p graf-after--p">The fix was surprisingly simple‚Ää‚Äî‚Ääadd proper session management to <code class="markup--code markup--p-code">main.py</code>:</p><p name="3cb6" id="3cb6" class="graf graf--p graf-after--p">python</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="bash" name="d85d" id="d85d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-comment"># Before: session leaked across requests</span><br /><br /><span class="hljs-comment"># After: proper async session lifecycle management</span></span></pre><p name="e7fe" id="e7fe" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">pytest-asyncio configuration</strong>: Half the test failures were because pytest couldn‚Äôt run async tests. Adding <code class="markup--code markup--p-code">pytest-asyncio</code> to requirements and configuring it properly eliminated 20+ failures immediately.</p><p name="e573" id="e573" class="graf graf--p graf-after--p">Where have I heard this one before? Ay-sink-ee-oooooh!</p><h4 name="eff3" id="eff3" class="graf graf--h4 graf-after--p">Phase 2: Fixture rehabilitation</h4><p name="7b1c" id="7b1c" class="graf graf--p graf-after--h4"><strong class="markup--strong markup--p-strong">Missing db_session fixture</strong>: Nine tests were failing because they expected an async database session fixture that didn‚Äôt exist. Creating the fixture in <code class="markup--code markup--p-code">conftest.py</code> unblocked an entire category of repository tests. I still don‚Äôt understand why my bots write tests and either don‚Äôt create the fixtures for the tests (and then act surprised when they fail) or create them and then ‚Äúclean them up,‚Äù like some overclocked housekeeper.</p><p name="f8bf" id="f8bf" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Orchestration engine test refactoring</strong>: Tests were using mock domain models instead of real ones, causing contract mismatches. Updating them to use actual domain objects fixed another cluster of failures. Beware of test mocks! They are needed when you are testing workflows that are not fully built yet, but if they linger beyond when they are needed, they will trip you up.</p><h4 name="3491" id="3491" class="graf graf--h4 graf-after--p">Phase 3: Contract alignment</h4><p name="9d00" id="9d00" class="graf graf--p graf-after--h4"><strong class="markup--strong markup--p-strong">Enum case drift</strong>: Intent classification tests were failing because they expected different enum cases than the implementation was using. The kind of drift that happens when you‚Äôre moving fast and not running tests regularly. (It also seems to happen a lot because either these bots get sloppy or they are mixing up knowledge from programming languages with different conventions.)</p><p name="3911" id="3911" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Repository interface changes</strong>: Some tests expected connection pools while others expected sessions. The infrastructure changes we‚Äôd made for better async support had shifted interfaces without updating tests.</p><h3 name="2e0b" id="2e0b" class="graf graf--h3 graf-after--p">The psychological challenge</h3><p name="4389" id="4389" class="graf graf--p graf-after--h3">The hardest part wasn‚Äôt the technical fixes‚Ää‚Äî‚Ääit was maintaining the belief that the situation was recoverable. When you see 144 failures, the rational response is panic. When you fix 10 and still have 134 remaining, it‚Äôs easy to conclude you‚Äôre making no progress.</p><p name="d56b" id="d56b" class="graf graf--p graf-after--p">The breakthrough came when we started categorizing failures instead of just counting them. Once we could see that most failures were infrastructure issues rather than logic problems, the path forward became clearer.</p><h3 name="42ca" id="42ca" class="graf graf--h3 graf-after--p">The momentum¬†shift</h3><p name="a816" id="a816" class="graf graf--p graf-after--h3">Around hour 4 of the recovery session, something shifted. The fixes started cascading. Resolving the async session leak eliminated 15 failures. Configuring pytest-asyncio properly fixed another 20. Adding the missing fixture unblocked 9 more.</p><p name="591d" id="591d" class="graf graf--p graf-after--p">Suddenly we weren‚Äôt fighting individual test failures‚Ää‚Äî‚Ääwe were addressing systemic issues that affected multiple test categories. The pass rate went from 2% to 30% to 60% to 87% as each infrastructure fix unlocked multiple working tests.</p><h3 name="a868" id="a868" class="graf graf--h3 graf-after--p">What was still broken (and why that was¬†OK)</h3><p name="8e4f" id="8e4f" class="graf graf--p graf-after--h3">The remaining 13% of test failures fall into categories that represent real work, not just infrastructure debt:</p><p name="9861" id="9861" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">FileRepository pool vs session architecture</strong>: Tests expect connection pools but the implementation now uses sessions. This represents an architectural decision that needs to be resolved, not just a bug to fix.</p><p name="11f5" id="11f5" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">API integration contract drift</strong>: Some query service tests are failing because the interfaces have evolved during development. These failures are telling us about API design decisions we need to make.</p><p name="393d" id="393d" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Logic assertion mismatches</strong>: Tests expecting specific float values or exact string matches that need to be updated for current implementation behavior.</p><p name="1a1b" id="1a1b" class="graf graf--p graf-after--p">These aren‚Äôt blocking failures‚Ää‚Äî‚Ääthey‚Äôre indicators of technical decisions that need conscious resolution.</p><h3 name="61fe" id="61fe" class="graf graf--h3 graf-after--p">The infrastructure lessons</h3><p name="8c9f" id="8c9f" class="graf graf--p graf-after--h3">The recovery taught us several important principles about test infrastructure:</p><p name="512a" id="512a" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Async testing requires specific setup.</strong> pytest-asyncio isn‚Äôt optional when you‚Äôre building async systems‚Ää‚Äî‚Ääit‚Äôs foundational infrastructure that needs to be configured correctly from the start.</p><p name="4332" id="4332" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Database session management is critical.</strong> Session leaks don‚Äôt just affect performance‚Ää‚Äî‚Ääthey make tests unpredictable and unreliable. Proper session lifecycle management is essential for test stability.</p><p name="522d" id="522d" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Formatting consistency reduces cognitive load.</strong> When you‚Äôre debugging complex failures, code formatting issues become mental overhead you can‚Äôt afford. Automated formatting is productivity infrastructure.</p><p name="5c7b" id="5c7b" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Systematic triage beats random fixing.</strong> Categorizing failures by root cause reveals the high-leverage fixes that unblock multiple tests at once.</p><h3 name="9323" id="9323" class="graf graf--h3 graf-after--p">The AI assistance reality</h3><p name="ccfc" id="ccfc" class="graf graf--p graf-after--h3">Cursor Assistant was invaluable for systematic analysis and fixture creation. But the recovery process highlighted something important: AI is excellent at executing solutions but human judgment is essential for prioritization.</p><p name="f5be" id="f5be" class="graf graf--p graf-after--p">When facing 144 failures, AI wants to fix them all in parallel. This can lead to a monomaniacal bug hunt based on guesswork that easily ends up down infinite rabbit holes.</p><p name="bdcc" id="bdcc" class="graf graf--p graf-after--p">Human insight recognizes that fixing async session management will eliminate 20 failures, while fixing individual assertion errors will eliminate one failure each.</p><p name="42e1" id="42e1" class="graf graf--p graf-after--p">The most effective pattern: human diagnoses systemic issues, AI executes systematic fixes.</p><h3 name="7850" id="7850" class="graf graf--h3 graf-after--p">The unexpected benefit</h3><p name="3655" id="3655" class="graf graf--p graf-after--h3">The test suite recovery revealed something we hadn‚Äôt appreciated: our architecture is actually quite solid. The failures were mostly infrastructure and configuration issues, not fundamental design problems.</p><p name="ee27" id="ee27" class="graf graf--p graf-after--p">The domain models are working correctly. The repository pattern is sound. The orchestration engine is reliable. The intent classification is accurate. The components we built with careful design are holding up under scrutiny.</p><p name="b9a6" id="b9a6" class="graf graf--p graf-after--p">That‚Äôs‚Ä¶ actually pretty encouraging.</p><h3 name="9c18" id="9c18" class="graf graf--h3 graf-after--p">Looking forward</h3><p name="3576" id="3576" class="graf graf--p graf-after--h3">87% pass rate isn‚Äôt perfect, but it‚Äôs functional. (Spoiler: It will get better.)</p><p name="3726" id="3726" class="graf graf--p graf-after--p">The remaining failures represent conscious decisions to make rather than accumulated debt to fix. The test infrastructure is now solid enough to support ongoing development without constant firefighting.</p><p name="8945" id="8945" class="graf graf--p graf-after--p">More importantly, we‚Äôve established a pattern for handling technical debt systematically rather than reactively. When the next batch of tests starts failing (and they will), we have a process for recovery that doesn‚Äôt involve panic and random fixes.</p><p name="7e37" id="7e37" class="graf graf--p graf-after--p graf--trailing">The great test suite recovery is complete. Now we can get back to building features instead of fighting infrastructure.</p></div></div>f:["$","$L1a",null,{"post":{"title":"From 2% to 87%: The Great Test Suite Recovery","excerpt":"","url":"/blog/from-2-to-87","publishedAt":"Invalid Date","publishedAtISO":"","author":"christian crumlish","readingTime":"5 min read","tags":["Building in Public"],"guid":"https://medium.com/building-piper-morgan/b7c3ef25cbdc","featuredImage":"/assets/blog-images/b7c3ef25cbdc-featured.webp","slug":"from-2-to-87","category":"building","workDate":"Jul 13, 2025","workDateISO":"2025-07-13T00:00:00.000Z","cluster":"production-transformation","featured":false},"content":{"title":"From 2% to 87%: The Great Test Suite Recovery","subtitle":"July 13","content":"$1b","author":"christian crumlish","canonicalLink":"","publishedDate":"2025-08-04T13:59:01.673Z","filename":"2025-08-04_From-2--to-87---The-Great-Test-Suite-Recovery-b7c3ef25cbdc.html"}}]
15:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
11:null
1c:I[8175,[],"IconMark"]
13:{"metadata":[["$","title","0",{"children":"From 2% to 87%: The Great Test Suite Recovery | Piper Morgan"}],["$","meta","1",{"name":"description","content":"July 13"}],["$","meta","2",{"name":"author","content":"Christian Crumlish"}],["$","meta","3",{"name":"keywords","content":"AI,Product Management,Methodology,Building in Public"}],["$","meta","4",{"name":"creator","content":"Christian Crumlish"}],["$","meta","5",{"name":"publisher","content":"Christian Crumlish"}],["$","meta","6",{"name":"robots","content":"index, follow"}],["$","meta","7",{"name":"googlebot","content":"index, follow"}],["$","link","8",{"rel":"canonical","href":"https://pipermorgan.ai/"}],["$","meta","9",{"name":"format-detection","content":"telephone=no, address=no, email=no"}],["$","meta","10",{"property":"og:title","content":"From 2% to 87%: The Great Test Suite Recovery"}],["$","meta","11",{"property":"og:description","content":"July 13"}],["$","meta","12",{"property":"og:type","content":"article"}],["$","meta","13",{"property":"article:author","content":"christian crumlish"}],["$","meta","14",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","15",{"name":"twitter:title","content":"From 2% to 87%: The Great Test Suite Recovery"}],["$","meta","16",{"name":"twitter:description","content":"July 13"}],["$","link","17",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"32x33"}],["$","link","18",{"rel":"icon","href":"/favicon.ico","sizes":"32x32","type":"image/x-icon"}],["$","link","19",{"rel":"icon","href":"/pm-favicon-16.png","sizes":"16x16","type":"image/png"}],["$","link","20",{"rel":"icon","href":"/pm-favicon-32.png","sizes":"32x32","type":"image/png"}],["$","link","21",{"rel":"icon","href":"/pm-favicon-48.png","sizes":"48x48","type":"image/png"}],["$","link","22",{"rel":"apple-touch-icon","href":"/pm-favicon-180.png","sizes":"180x180","type":"image/png"}],["$","link","23",{"rel":"icon","href":"/pm-favicon-192.png","sizes":"192x192","type":"image/png"}],["$","$L1c","24",{}]],"error":null,"digest":"$undefined"}
18:"$13:metadata"
