<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>When Your Infrastructure Gets Smarter Than Your Tests</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">When Your Infrastructure Gets Smarter Than Your Tests</h1>
</header>
<section data-field="subtitle" class="p-summary">
July 20
</section>
<section data-field="body" class="e-content">
<section name="c63f" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="1cd3" id="1cd3" class="graf graf--h3 graf--leading graf--title">When Your Infrastructure Gets Smarter Than Your Tests</h3><figure name="e4b9" id="e4b9" class="graf graf--figure graf--startsWithDoubleQuote graf-after--h3"><img class="graf-image" data-image-id="1*WlrTgEhmMAkLMM5is6mr5w.png" data-width="1536" data-height="1024" data-is-featured="true" alt="A smart house outwits an inspector" src="https://cdn-images-1.medium.com/max/800/1*WlrTgEhmMAkLMM5is6mr5w.png"><figcaption class="imageCaption">“I’ve outsmarted you!”</figcaption></figure><p name="3414" id="3414" class="graf graf--p graf-after--figure"><em class="markup--em markup--p-em">July 20</em></p><p name="1841" id="1841" class="graf graf--p graf--hasDropCapModel graf--hasDropCap graf-after--p"><span class="graf-dropCap">T</span>here I was on a Sunday morning staring at what looked like catastrophic test failures across my entire MCP integration, wondering if I’d somehow broken everything overnight. Ninety-two tests passing, three mysteriously failing, and a nagging suspicion that something fundamental had shifted while I wasn’t paying attention.</p><p name="a5c4" id="a5c4" class="graf graf--p graf-after--p">Turns out, my infrastructure had gotten smarter than my tests.</p><h3 name="d0dd" id="d0dd" class="graf graf--h3 graf-after--p">A “simple” content search implementation</h3><p name="15d1" id="15d1" class="graf graf--p graf-after--h3">The plan seemed straightforward enough: implement real content search for PM-038. We had this basic MCP (Model Context Protocol) integration that was doing filename matching — you know, the kind of thing you build for a demo that works just well enough to fool yourself into thinking it’s production-ready.</p><p name="2b69" id="2b69" class="graf graf--p graf-after--p">The goal was simple: when someone searches for “project timeline,” actually find documents that <em class="markup--em markup--p-em">contain</em> those words, not just files named “project_timeline.txt.” Revolutionary stuff, right?</p><p name="d203" id="d203" class="graf graf--p graf-after--p">We were building on a breakthrough in the previous work session, a 642x performance improvement.</p><p name="075a" id="075a" class="graf graf--p graf-after--p">By the way, every time I say “we built” here, it really means Claude Code suggested something, I said “that sounds reasonable,” and then watched in amazement as patterns I’d never seen before materialized in my codebase.</p><p name="870a" id="870a" class="graf graf--p graf-after--p">The breakthrough had come when we moved from connection-per-request to connection pooling, and here’s the thing about exponential improvements — they don’t just make your system faster. They make your system fundamentally different. And different systems need different tests.</p><h3 name="2e7f" id="2e7f" class="graf graf--h3 graf-after--p">When tests Become archaeological evidence</h3><p name="b7b9" id="b7b9" class="graf graf--p graf-after--h3">The failing tests weren’t actually failing because something was broken. They were failing because they were testing for behavior that no longer existed.</p><p name="ecc8" id="ecc8" class="graf graf--p graf-after--p">Picture this: you write tests to verify that your car can go 60 mph on the highway. Then someone swaps out your engine with a rocket, and suddenly your tests are failing because they’re checking for “reasonable highway speeds” while your car is now capable of breaking the sound barrier.</p><p name="64dd" id="64dd" class="graf graf--p graf-after--p">That’s essentially what happened. We’d built tests around the assumption that content search would be slow, unreliable, and basically terrible. When the infrastructure became genuinely excellent, the tests started complaining.</p><p name="e00c" id="e00c" class="graf graf--p graf-after--p">The most telling failure was a test checking that search results came back within 500ms. Our new implementation was consistently returning results in 60ms, and the test framework was flagging this as “suspiciously fast.”</p><p name="e4a3" id="e4a3" class="graf graf--p graf-after--p">Mind you, this is exactly the kind of problem you want to have.</p><p name="f1e0" id="f1e0" class="graf graf--p graf-after--p">Why would you flag that at all? Well searches that fail are often incredibly fast.</p><h3 name="3e51" id="3e51" class="graf graf--h3 graf-after--p">The headless infrastructure discovery</h3><p name="888b" id="888b" class="graf graf--p graf-after--h3">The real revelation came during staging deployment. We’d built this incredibly sophisticated infrastructure — connection pooling, circuit breakers, TF-IDF scoring, comprehensive health monitoring — and then discovered we’d forgotten to wire it up to anything users could actually access.</p><p name="3f86" id="3f86" class="graf graf--p graf-after--p">It was like building a Formula 1 race car and then realizing you’d forgotten to install a steering wheel.</p><p name="687f" id="687f" class="graf graf--p graf-after--p">Three AI agents had been working in concert (Claude Code handling infrastructure, Cursor managing QA, and Opus coordinating architecture), and they’d collectively built this amazing foundation that was just… sitting there, waiting for someone to connect it to the intent classification system so humans could actually use it.</p><p name="6511" id="6511" class="graf graf--p graf-after--p">The technical term for this, I decided, is “headless infrastructure” — when your backend becomes so sophisticated that your frontend can’t keep up.</p><h3 name="17a7" id="17a7" class="graf graf--h3 graf-after--p">The natural-language breakthrough</h3><p name="dadc" id="dadc" class="graf graf--p graf-after--h3">Once we connected the pipes, something magical happened. Users could suddenly say “find documents about project timeline” and get real-time results powered by our 642x improvement.</p><p name="054c" id="054c" class="graf graf--p graf-after--p">The complete pipeline looked like this:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="csharp" name="3f5a" id="3f5a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">User: <span class="hljs-string">&quot;find documents about project timeline&quot;</span><br />   ↓ <span class="hljs-function">Intent <span class="hljs-title">Classifier</span> (<span class="hljs-params"><span class="hljs-number">85</span>% confidence</span>)</span><br />{category: QUERY, action: search_documents}<br />   ↓ Query Router<br />FileQueryService.find_documents_about_topic()<br />   ↓ MCP Integration <span class="hljs-keyword">with</span> <span class="hljs-number">642</span>x Performance<br />Real content search <span class="hljs-keyword">with</span> TF-IDF ranking<br />   ↓ Results<br />Actual relevant documents, <span class="hljs-keyword">not</span> filename matches</span></pre><p name="5580" id="5580" class="graf graf--p graf-after--pre">The whole thing processed in about 60ms. Remember, our target was 500ms.</p><h3 name="6d78" id="6d78" class="graf graf--h3 graf-after--p">Lessons from AI-assisted infrastructure evolution</h3><p name="ac83" id="ac83" class="graf graf--p graf-after--h3">Working with multiple AI agents on this taught me something interesting about modern development patterns. Each agent brought different strengths:</p><ul class="postList"><li name="33fa" id="33fa" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Code</strong>: Relentless focus on implementation details and performance optimization</li><li name="5a35" id="5a35" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Cursor</strong>: Systematic validation and edge case discovery</li><li name="5c8f" id="5c8f" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Opus</strong>: Strategic architecture decisions and integration oversight</li></ul><p name="d141" id="d141" class="graf graf--p graf-after--li">But here’s what’s fascinating: together, they built infrastructure that exceeded what any of them would have created individually. The 642x improvement, for example, had emerged from the intersection of Code’s connection pooling insight, Cursor’s performance validation, and Opus’s architectural guidance.</p><p name="00dd" id="00dd" class="graf graf--p graf-after--p">It’s like having a team where each member is really good at their specialty, but the magic happens in the collaboration patterns between them.</p><h3 name="ee01" id="ee01" class="graf graf--h3 graf-after--p">The context compaction problem</h3><p name="6c39" id="6c39" class="graf graf--p graf-after--h3">One unexpected challenge was what I started calling “context compaction seams” — moments when session logs get compressed and important narrative threads get lost. Claude Code, for example, occasionally needs to “digest” its previous context before continuing and can become somewhat amnesiac after those moments.</p><p name="7b73" id="7b73" class="graf graf--p graf-after--p">At one point, after a particularly productive session, interrupted by one of these breaks, I asked Code what we had been working on and it characterized the work as “just documentation and ADR creation.” In reality, we’d delivered a complete production-grade staging environment with 8 containerized services, comprehensive monitoring, automated deployment scripts, and rollback procedures.</p><p name="6dc6" id="6dc6" class="graf graf--p graf-after--p">I had to remind it of what we’d covered in the intervening time. Fortunately, I could do this by pointing it at the session log it had itself been maintaining before the mindwipe.</p><p name="62a7" id="62a7" class="graf graf--p graf-after--p">The human role turned out to be crucial as a “continuity anchor” — maintaining the big picture when AI agents lose track of scope after context compression.</p><h3 name="ac7a" id="ac7a" class="graf graf--h3 graf-after--p">When your infrastructure outpaces your implementation</h3><p name="22f6" id="22f6" class="graf graf--p graf-after--h3">So what do you do when your tests start failing because your system got too good?</p><p name="a088" id="a088" class="graf graf--p graf-after--p">First, celebrate. Having infrastructure that exceeds your tests’ expectations is a high-quality problem.</p><p name="02a2" id="02a2" class="graf graf--p graf-after--p">Second, update your tests to match your new reality. If your system is now 8x faster than your target, adjust your expectations accordingly.</p><p name="8940" id="8940" class="graf graf--p graf-after--p">Third, look for the “headless infrastructure” pattern. When your backend becomes sophisticated enough, you might discover gaps where your application layer hasn’t kept up.</p><h3 name="bafe" id="bafe" class="graf graf--h3 graf-after--p">The Sunday morning retrospective</h3><p name="c2df" id="c2df" class="graf graf--p graf-after--h3">Looking back at those session logs, what started as “implement real content search” turned into a complete transformation of how our system works. The fake-to-real content search was just the surface layer. Underneath, we’d built production-ready infrastructure that could handle serious scale.</p><p name="8667" id="8667" class="graf graf--p graf-after--p">And the 642x improvement wasn’t just about connection pooling — it was about recognizing that good process compounds. When you have proper TDD discipline, systematic validation, and clear architectural boundaries, improvements don’t just add up. They multiply.</p><p name="4d92" id="4d92" class="graf graf--p graf-after--p">And sometimes, your infrastructure gets so good that your tests can’t keep up.</p><p name="116e" id="116e" class="graf graf--p graf-after--p graf--trailing">That’s when you know you’re doing something right.</p></div></div></section><section name="2ff1" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="df4b" id="df4b" class="graf graf--p graf--leading"><em class="markup--em markup--p-em">Next on Building Piper Morgan: The Foundation Sprint: Why We Clean House Before Building New Rooms or how we really started cooking with gas.</em></p><p name="7f5d" id="7f5d" class="graf graf--p graf-after--p graf--trailing"><em class="markup--em markup--p-em">What’s your experience with infrastructure outpacing implementation? Have you seen the “headless infrastructure” pattern in your own projects? I’d love to hear about moments when your tests failed because your system got too good.</em></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@mediajunkie" class="p-author h-card">christian crumlish</a> on <a href="https://medium.com/p/2582f1c7b3d5"><time class="dt-published" datetime="2025-08-06T13:02:46.273Z">August 6, 2025</time></a>.</p><p><a href="https://medium.com/@mediajunkie/when-your-infrastructure-gets-smarter-than-your-tests-2582f1c7b3d5" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 9, 2025.</p></footer></article></body></html>