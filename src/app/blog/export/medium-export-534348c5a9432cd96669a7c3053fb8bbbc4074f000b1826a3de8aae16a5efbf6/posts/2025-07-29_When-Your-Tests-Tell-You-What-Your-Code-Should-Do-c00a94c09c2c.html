<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>When Your Tests Tell You What Your Code Should Do</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">When Your Tests Tell You What Your Code Should Do</h1>
</header>
<section data-field="subtitle" class="p-summary">
June 27
</section>
<section data-field="body" class="e-content">
<section name="6cb0" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="0cdf" id="0cdf" class="graf graf--h3 graf--leading graf--title">When Your Tests Tell You What Your Code Should Do</h3><figure name="c7cd" id="c7cd" class="graf graf--figure graf--startsWithDoubleQuote graf-after--h3"><img class="graf-image" data-image-id="1*B0ieODRpd1YHfw4S0XySSA.png" data-width="1536" data-height="1024" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*B0ieODRpd1YHfw4S0XySSA.png"><figcaption class="imageCaption">“You can do it!”</figcaption></figure><p name="7d2c" id="7d2c" class="graf graf--p graf-after--figure"><em class="markup--em markup--p-em">June 27</em></p><p name="60d7" id="60d7" class="graf graf--p graf--hasDropCapModel graf--hasDropCap graf-after--p"><span class="graf-dropCap">We</span> were down to just two failing tests out of 64, and my first instinct was what it always is when tests fail after escaping a crisis: these tests must be wrong.</p><p name="e647" id="e647" class="graf graf--p graf-after--p">I mean, it made sense. We’d just come through the 48-hour rollercoaster — that epic journey to complete disaster and back with from “LIFE SAVER !!!” redemption. The system was working. File uploads were processing. Analysis was running end-to-end. Surely a couple of stubborn test failures were just… artifacts from the chaos.</p><p name="0c7e" id="0c7e" class="graf graf--p graf-after--p">Turns out, the tests weren’t wrong. They were trying to teach me about my own architecture.</p><h3 name="e1fd" id="e1fd" class="graf graf--h3 graf-after--p">Coming back from chaos</h3><p name="9427" id="9427" class="graf graf--p graf-after--h3">After the 48-hour rollercoaster, we had msfr this beautiful recovery: 64 tests, clean architecture, everything working. But when I ran the full suite, 2 tests were still failing in the DocumentAnalyzer.</p><p name="98f2" id="98f2" class="graf graf--p graf-after--p">Classic developer reaction: “Well, those tests are probably just outdated expectations from before we fixed everything.”</p><p name="cecc" id="cecc" class="graf graf--p graf-after--p">The failing tests were complaining that DocumentAnalyzer was throwing FileAnalysisError exceptions instead of returning AnalysisResult objects with error metadata. My first thought? “These tests just haven’t been updated to match our new exception-handling approach.”</p><p name="ddbe" id="ddbe" class="graf graf--p graf-after--p">So I started to “fix” the tests. (Always a bad instinct.)</p><h3 name="d55c" id="d55c" class="graf graf--h3 graf-after--p">The moment everything clicked</h3><p name="22b5" id="22b5" class="graf graf--p graf-after--h3">But then I did something I don’t always remember to do: I looked at the <em class="markup--em markup--p-em">other</em> analyzers to see what pattern they were actually following (OK, I asked Cursor to look and tell me).</p><ul class="postList"><li name="65fd" id="65fd" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">CSVAnalyzer: </strong>Returns AnalysisResult with error info in metadata.</li><li name="17d1" id="17d1" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">TextAnalyzer: </strong>Returns AnalysisResult with error info in metadata.</li><li name="dbfd" id="dbfd" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">DocumentAnalyzer: </strong>Throws FileAnalysisError exceptions.</li></ul><p name="38b3" id="38b3" class="graf graf--p graf-after--li">Hmm.</p><p name="0f92" id="0f92" class="graf graf--p graf-after--p">One of these things was not like the others.</p><p name="e3af" id="e3af" class="graf graf--p graf-after--p">That’s when it hit me: the tests weren’t wrong about what they expected. DocumentAnalyzer was doing it wrong.</p><h3 name="83a9" id="83a9" class="graf graf--h3 graf-after--p">Tests as architectural documentation</h3><p name="1711" id="1711" class="graf graf--p graf-after--h3">Here’s what I learned from those two “failing” tests: they weren’t testing what the code currently did. They were documenting what the code <em class="markup--em markup--p-em">should</em> do according to our domain model.</p><p name="17d6" id="17d6" class="graf graf--p graf-after--p">The AnalysisResult domain object was designed with a clear contract: analyzers always return results, with errors going into the metadata field. Never throw exceptions. <strong class="markup--strong markup--p-strong">Always return something useful.</strong></p><p name="7c97" id="7c97" class="graf graf--p graf-after--p">CSVAnalyzer and TextAnalyzer were following this contract perfectly. But somewhere along the way — probably during one of those frantic “let’s just get this working” moments — someone (okay, it was probably me) had allowed DocumentAnalyzer to throw exceptions instead.</p><p name="cf1b" id="cf1b" class="graf graf--p graf-after--p">The tests were trying to tell me: “Hey, you have a domain contract here. DocumentAnalyzer is violating it.”</p><h3 name="fb2a" id="fb2a" class="graf graf--h3 graf-after--p">When code drifts from intention</h3><p name="07da" id="07da" class="graf graf--p graf-after--h3">This is one of those subtle ways systems drift from their original intentions. It’s not dramatic architectural decay — it’s just inconsistency. One component doing things slightly differently from its siblings.</p><p name="173a" id="173a" class="graf graf--p graf-after--p">But that inconsistency compounds. Today it’s “DocumentAnalyzer throws exceptions while everyone else returns error metadata.” Tomorrow it’s “well, some analyzers throw exceptions, so I guess PDFAnalyzer can too.” Before you know it, your error handling is a mess and nobody remembers what the original pattern was supposed to be.</p><p name="65f5" id="65f5" class="graf graf--p graf-after--p">Mind you, this kind of drift happens to everyone. Especially when you’re moving fast, fixing urgent issues, or trying to get something working after a crisis. The question is whether you catch it before it spreads.</p><h3 name="ef02" id="ef02" class="graf graf--h3 graf-after--p">The beauty of domain contracts</h3><p name="e5c2" id="e5c2" class="graf graf--p graf-after--h3">What struck me about this whole episode was how clear the domain contract actually was, once I paid attention to it.</p><p name="4f99" id="4f99" class="graf graf--p graf-after--p">AnalysisResult was designed to <em class="markup--em markup--p-em">always</em> be returned. Success or failure, you get an AnalysisResult object. If something went wrong, the error information goes in the metadata field, but you still get a proper result object with whatever analysis could be completed.</p><p name="f271" id="f271" class="graf graf--p graf-after--p">This isn’t just a nice-to-have pattern. It’s what allows the rest of the system to handle analysis results consistently, regardless of which analyzer produced them or whether everything went perfectly.</p><p name="5cfe" id="5cfe" class="graf graf--p graf-after--p">When DocumentAnalyzer started throwing exceptions instead, it broke that contract. The calling code had to start handling two different error patterns: sometimes you get an AnalysisResult with error metadata, sometimes you get an exception. That’s cognitive overhead for every developer who touches the code.</p><h3 name="c154" id="c154" class="graf graf--h3 graf-after--p">Following the test guidance</h3><p name="9a3c" id="9a3c" class="graf graf--p graf-after--h3">So instead of changing the tests to match the exception-throwing behavior, I changed DocumentAnalyzer to honor the domain contract.</p><p name="47d2" id="47d2" class="graf graf--p graf-after--p">The fix was straightforward: wrap the analysis logic in try-catch, and when things go wrong, return an AnalysisResult with the error information in metadata instead of throwing the exception.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="python" name="e566" id="e566" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-comment"># Before: Contract violation</span><br /><span class="hljs-keyword">if</span> analysis_failed:<br />    <span class="hljs-keyword">raise</span> FileAnalysisError(<span class="hljs-string">&quot;Analysis failed&quot;</span>)<br /><br /><span class="hljs-comment"># After: Honoring domain contract  </span><br /><span class="hljs-keyword">if</span> analysis_failed:<br />    <span class="hljs-keyword">return</span> AnalysisResult(<br />        content_type=<span class="hljs-string">&quot;document&quot;</span>,<br />        metadata={<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;Analysis failed&quot;</span>}<br />    )</span></pre><p name="25bd" id="25bd" class="graf graf--p graf-after--pre">The moment I made that change: 64/64 tests passing.</p><h3 name="aa45" id="aa45" class="graf graf--h3 graf-after--p">Tests as conversation partners</h3><p name="2d37" id="2d37" class="graf graf--p graf-after--h3">What this experience taught me is that tests can be conversation partners in architectural decisions, not just validators of current behavior.</p><p name="db49" id="db49" class="graf graf--p graf-after--p">When tests fail, especially after a period of rapid change, the question isn’t just “what do I need to change to make this pass?” It’s “what is this test trying to tell me about my system’s intentions?”</p><p name="8cd5" id="8cd5" class="graf graf--p graf-after--p">Those two “failing” tests weren’t obstacles to overcome. They were documentation of a better way to structure error handling across the analysis layer. They were architectural guidance disguised as test failures.</p><h3 name="a15a" id="a15a" class="graf graf--h3 graf-after--p">The larger pattern</h3><p name="de5e" id="de5e" class="graf graf--p graf-after--h3">This connects to something larger about how tests function in a mature codebase. Good tests don’t just verify that code works — they document what “working” means according to your system’s design principles.</p><p name="6bc8" id="6bc8" class="graf graf--p graf-after--p">When you write tests, you’re not just checking current behavior. You’re encoding architectural intentions. You’re creating a conversation between your current understanding and your future self’s implementation decisions.</p><p name="d85e" id="d85e" class="graf graf--p graf-after--p">The pattern recognition — seeing that DocumentAnalyzer was the outlier — came from slowing down enough to actually look at what the tests were expecting versus what the code was doing.</p><h3 name="4782" id="4782" class="graf graf--h3 graf-after--p">When to trust your tests</h3><p name="7c8e" id="7c8e" class="graf graf--p graf-after--h3">So when should you trust your tests over your code? Here are some signals I’ve learned to watch for:</p><p name="7578" id="7578" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Trust tests when</strong>: They’re checking domain contracts, not just implementation details. When multiple similar components follow one pattern and one outlier follows another. When tests are failing after rapid changes or crisis periods.</p><p name="4c76" id="4c76" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Question tests when</strong>: They’re testing implementation details that could reasonably change. When they’re checking specific error messages instead of error handling patterns. When they were written for a different phase of the project’s evolution.</p><p name="0bcf" id="0bcf" class="graf graf--p graf-after--p">The key is learning to distinguish between tests that encode architectural wisdom and tests that encode temporary implementation choices.</p><h3 name="1cac" id="1cac" class="graf graf--h3 graf-after--p">The 64/64 moment</h3><p name="975c" id="975c" class="graf graf--p graf-after--h3">There’s something satisfying about seeing 64/64 tests pass after making an architectural decision based on test guidance. It’s not just “yay, green checkmarks.” It’s validation that your system has a coherent design philosophy, and that your tests are documenting it accurately.</p><p name="312a" id="312a" class="graf graf--p graf-after--p">That moment when DocumentAnalyzer fell into line with the established pattern, and suddenly all the error handling across the analysis layer was consistent — that’s what good architecture feels like. Not perfect code, but <em class="markup--em markup--p-em">coherent</em> code.</p><h3 name="0731" id="0731" class="graf graf--h3 graf-after--p">Listening to your codebase</h3><p name="4d25" id="4d25" class="graf graf--p graf-after--h3">The broader lesson here is about listening to your codebase. Tests are one way it talks to you. Patterns across similar components are another. Inconsistencies that make you pause and think “wait, why does this one work differently?” — those are conversations waiting to happen.</p><p name="7503" id="7503" class="graf graf--p graf-after--p">Your codebase is constantly trying to tell you about its own design principles. Sometimes through test failures. Sometimes through code that feels awkward to write. Sometimes through inconsistencies that make onboarding new team members harder than it should be.</p><p name="3031" id="3031" class="graf graf--p graf-after--p graf--trailing">The trick is slowing down enough to listen.</p></div></div></section><section name="10fe" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="a079" id="a079" class="graf graf--p graf--leading"><em class="markup--em markup--p-em">Next on Building Piper Morgan: “Following Your Own Patterns” on that magical state where your architecture makes new features feel inevitable rather than difficult.</em></p><p name="eabe" id="eabe" class="graf graf--p graf-after--p graf--trailing"><em class="markup--em markup--p-em">What’s your experience with tests as architectural guidance? Have you had moments when “failing” tests led you to better design decisions? I’d love to hear about times when your codebase taught you something you didn’t expect to learn.</em></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@mediajunkie" class="p-author h-card">christian crumlish</a> on <a href="https://medium.com/p/c00a94c09c2c"><time class="dt-published" datetime="2025-07-29T13:18:40.812Z">July 29, 2025</time></a>.</p><p><a href="https://medium.com/@mediajunkie/when-your-tests-tell-you-what-your-code-should-do-c00a94c09c2c" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 9, 2025.</p></footer></article></body></html>