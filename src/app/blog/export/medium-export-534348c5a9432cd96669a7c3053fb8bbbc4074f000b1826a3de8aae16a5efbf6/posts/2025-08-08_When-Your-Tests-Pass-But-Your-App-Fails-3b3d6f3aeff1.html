<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>When Your Tests Pass But Your App Fails</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">When Your Tests Pass But Your App Fails</h1>
</header>
<section data-field="subtitle" class="p-summary">
July 9, that evening
</section>
<section data-field="body" class="e-content">
<section name="2ce1" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="f06a" id="f06a" class="graf graf--h3 graf--leading graf--title">When Your Tests Pass But Your App Fails</h3><figure name="1ec7" id="1ec7" class="graf graf--figure graf--startsWithDoubleQuote graf-after--h3"><img class="graf-image" data-image-id="1*nFYPDGfm2RCnKNwYPz0YYw.png" data-width="1536" data-height="1024" data-is-featured="true" alt="A robot driver brags about passing the driving test but has driven its car into a wall" src="https://cdn-images-1.medium.com/max/800/1*nFYPDGfm2RCnKNwYPz0YYw.png"><figcaption class="imageCaption">“I passed the test!”</figcaption></figure><p name="bc0f" id="bc0f" class="graf graf--p graf-after--figure"><em class="markup--em markup--p-em">July 9, that evening</em></p><p name="0f20" id="0f20" class="graf graf--p graf--hasDropCapModel graf--hasDropCap graf-after--p"><span class="graf-dropCap">T</span>here’s a special kind of confidence that comes from seeing all your tests pass. Green checkmarks everywhere. Coverage at 98%. The CI/CD pipeline singing its happy song.</p><p name="a0ed" id="a0ed" class="graf graf--p graf-after--p">Then you run the app and it immediately crashes.</p><p name="75a9" id="75a9" class="graf graf--p graf-after--p">Welcome to the mocking trap, where your tests are lying to you with your full permission and encouragement.</p><h3 name="2a85" id="2a85" class="graf graf--h3 graf-after--p">The setup</h3><p name="e61a" id="e61a" class="graf graf--p graf-after--h3">It was still Tuesday (why is it always a Tuesday?) and we were flying high. PM-011 was almost done. The workflow persistence layer had beautiful unit tests. Every edge case covered. Every error condition handled.</p><p name="770e" id="770e" class="graf graf--p graf-after--p">The test output was poetry:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="python-repl" name="b7b3" id="b7b3" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">✓ WorkflowRepository.create persists workflow<br />✓ WorkflowRepository.update modifies state  <br />✓ WorkflowRepository.find_by_id retrieves correctly<br />✓ Error handling works for missing workflows<br />✓ Transaction rollback on failures<br /><span class="hljs-meta prompt_">...</span> <span class="language-python"><span class="hljs-number">47</span> more passing tests ...</span></span></pre><p name="f086" id="f086" class="graf graf--p graf-after--pre">Life was good. Ship it, right?</p><p name="f43f" id="f43f" class="graf graf--p graf-after--p">Wrong.</p><h3 name="52e6" id="52e6" class="graf graf--h3 graf-after--p">The reality check</h3><p name="4d49" id="4d49" class="graf graf--p graf-after--h3">First sign of trouble came during integration testing. Simple scenario: create a workflow, execute it, check the results.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="csharp" name="14c5" id="14c5" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">TASK_FAILED: <span class="hljs-string">&#x27;Workflow&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;tasks&#x27;</span></span></pre><p name="8329" id="8329" class="graf graf--p graf-after--pre">But… we tested that. Test #14 specifically verified that workflows have tasks. It was right there in green.</p><p name="c6c1" id="c6c1" class="graf graf--p graf-after--p">Time to look at test #14:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="scss" name="92c0" id="92c0" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">def <span class="hljs-built_in">test_workflow_has_tasks</span>():<br />    workflow = <span class="hljs-built_in">MagicMock</span>()<br />    workflow.tasks = [<span class="hljs-built_in">MagicMock</span>(), <span class="hljs-built_in">MagicMock</span>()]<br />    assert <span class="hljs-built_in">len</span>(workflow.tasks) == <span class="hljs-number">2</span>  # ✓ Passes!</span></pre><p name="30f2" id="30f2" class="graf graf--p graf-after--pre">Oh. Oh no.</p><h3 name="3d3f" id="3d3f" class="graf graf--h3 graf-after--p">The mocking hall of shame</h3><p name="388d" id="388d" class="graf graf--p graf-after--h3">As we dug deeper, the situation got worse. Our test suite was less “testing the code” and more “testing our ability to configure mocks.”</p><p name="e4e1" id="e4e1" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">The Greatest Hits:</strong></p><ol class="postList"><li name="9d57" id="9d57" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">The Self-Fulfilling Mock</strong></li></ol><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="ini" name="6b20" id="6b20" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-attr">mock_repo.save</span> = MagicMock(return_value=<span class="hljs-literal">True</span>) assert mock_repo.save(workflow) == <span class="hljs-literal">True</span>  <span class="hljs-comment"># Always passes!</span></span></pre><p name="4da7" id="4da7" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">2. The Mock That Mocks Itself</strong></p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="ini" name="3494" id="3494" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-attr">workflow.execute</span> = MagicMock(side_effect=workflow.execute) <span class="hljs-comment"># Infinite recursion in production, passes in tests</span></span></pre><p name="6a58" id="6a58" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">3. The Schrodinger’s Mock</strong></p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="bash" name="5b01" id="5b01" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-comment"># Test assumes tasks exist workflow.get_next_task = MagicMock(return_value=task) # Reality: method doesn&#x27;t exist on Workflow class</span></span></pre><h3 name="b6ff" id="b6ff" class="graf graf--h3 graf-after--pre">The two-model problem</h3><p name="1ba5" id="1ba5" class="graf graf--p graf-after--h3">But wait, it gets better. Remember that error about ‘Workflow’ having no ‘tasks’ attribute? Turns out we had two completely different Workflow classes:</p><ol class="postList"><li name="48dc" id="48dc" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">WorkflowDefinition</strong> (from the POC) — Has tasks, lives in <code class="markup--code markup--li-code">legacy/</code></li><li name="ba43" id="ba43" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Workflow</strong> (from the MVP) — No tasks attribute, lives in <code class="markup--code markup--li-code">domain/</code></li></ol><p name="d7c3" id="d7c3" class="graf graf--p graf-after--li">Our tests were mocking WorkflowDefinition behavior. Our code was using Workflow. They were about as compatible as cats and dogs at a dinner party. Close readers may notice this is hardly the first time we discovered we had built two of something. Why did this keep happening?</p><h3 name="7353" id="7353" class="graf graf--h3 graf-after--p">The archaeological dig</h3><p name="1625" id="1625" class="graf graf--p graf-after--h3">Finding this required software archaeology. Like real archaeology, but with more swearing and less cool hats.</p><p name="d8ee" id="d8ee" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Layer 1</strong> (Surface): Current tests, all passing<br><strong class="markup--strong markup--p-strong">Layer 2</strong> (two weeksago): MVP implementation, clean architecture<br><strong class="markup--strong markup--p-strong">Layer 3</strong> (three weeks ago): POC code, “temporary” solutions<br><strong class="markup--strong markup--p-strong">Layer 4</strong> (Bedrock): GitHub integration still importing from Layer 3</p><p name="e371" id="e371" class="graf graf--p graf-after--p">The POC was supposed to be thrown away. Instead, it was load-bearing.</p><h3 name="2758" id="2758" class="graf graf--h3 graf-after--p">The humbling</h3><p name="b6c7" id="b6c7" class="graf graf--p graf-after--h3">Here’s what hurt the most: we knew better. We’d read all the articles. (Well, they’ve read all the articles — a lot of this is super new to me). “Don’t over-mock.” “Test behavior, not implementation.” “Integration tests matter.”</p><p name="2588" id="2588" class="graf graf--p graf-after--p">But when deadlines loom and features need shipping, it’s so easy to mock your way to green checkmarks.</p><p name="0b61" id="0b61" class="graf graf--p graf-after--p">Our mocking strategy had evolved like this:</p><ol class="postList"><li name="c4d4" id="c4d4" class="graf graf--li graf-after--p">Write good integration test</li><li name="dab2" id="dab2" class="graf graf--li graf-after--li">Test is slow, makes CI unhappy</li><li name="c6f4" id="c6f4" class="graf graf--li graf-after--li">Add some mocks to speed it up</li><li name="79b1" id="79b1" class="graf graf--li graf-after--li">Test breaks when refactoring</li><li name="1d36" id="1d36" class="graf graf--li graf-after--li">Mock more things to make it pass</li><li name="6c17" id="6c17" class="graf graf--li graf-after--li">Repeat until test tests nothing</li></ol><h3 name="562d" id="562d" class="graf graf--h3 graf-after--li">The fix (and the lesson)</h3><p name="ee65" id="ee65" class="graf graf--p graf-after--h3">The solution was painful but necessary:</p><p name="2a95" id="2a95" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Step 1</strong>: Accept reality. The mocks had to go.</p><p name="b1af" id="b1af" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Step 2</strong>: Write ONE real integration test:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="ruby" name="be04" id="be04" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_workflow_actually_works</span>():<br />    <span class="hljs-comment"># Real repository, real database, real pain</span><br />    workflow = create_workflow(<span class="hljs-string">&quot;test&quot;</span>)<br />    workflow.add_task(...)  <span class="hljs-comment"># This failed immediately</span><br />    <span class="hljs-comment"># Good! Failing for the right reason!</span></span></pre><p name="f856" id="f856" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">Step 3</strong>: Fix the actual code, not the tests.</p><p name="e4c0" id="e4c0" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Step 4</strong>: Keep some unit tests, but test real behavior:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="csharp" name="8c72" id="8c72" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-function">def <span class="hljs-title">test_domain_logic</span>():<br />    # Real <span class="hljs-built_in">object</span>, <span class="hljs-keyword">not</span> mocks<br />    workflow</span> = Workflow(...)<br />    <span class="hljs-meta"># Test business rules, not framework plumbing</span></span></pre><h3 name="666f" id="666f" class="graf graf--h3 graf-after--pre">The deeper pattern</h3><p name="9b10" id="9b10" class="graf graf--p graf-after--h3">This wasn’t just about bad tests. It was about the stories we tell ourselves:</p><ul class="postList"><li name="d856" id="d856" class="graf graf--li graf--startsWithDoubleQuote graf-after--p">“We’ll refactor the POC later” (We won’t)</li><li name="7a28" id="7a28" class="graf graf--li graf--startsWithDoubleQuote graf-after--li">“Mocks make tests faster” (And less useful)</li><li name="a25d" id="a25d" class="graf graf--li graf--startsWithDoubleQuote graf-after--li">“100% coverage means it works” (It means it’s covered)</li><li name="31b7" id="31b7" class="graf graf--li graf--startsWithDoubleQuote graf-after--li">“Integration tests are slow” (Debugging production is slower)</li></ul><h3 name="b297" id="b297" class="graf graf--h3 graf-after--li">The test pyramid, revised</h3><p name="a681" id="a681" class="graf graf--p graf-after--h3">The test pyramid says: lots of unit tests, some integration tests, few E2E tests.</p><p name="c7f1" id="c7f1" class="graf graf--p graf-after--p">Our test pyramid looked more like a test hourglass: lots of mocked unit tests, no integration tests, lots of manual testing in production.</p><p name="514c" id="514c" class="graf graf--p graf-after--p">Here’s our new approach:</p><ol class="postList"><li name="dddc" id="dddc" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Domain tests</strong> (no mocks): Test business logic with real objects</li><li name="dbde" id="dbde" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Integration tests</strong> (minimal mocks): Test component interactions</li><li name="0c89" id="0c89" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">E2E tests</strong> (no mocks): Test critical user paths</li><li name="fae7" id="fae7" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Unit tests</strong> (careful mocks): Only for isolated algorithms</li></ol><h3 name="abdf" id="abdf" class="graf graf--h3 graf-after--li">What worked</h3><p name="5517" id="5517" class="graf graf--p graf-after--h3">Once we stopped lying to ourselves with mocks:</p><ul class="postList"><li name="6809" id="6809" class="graf graf--li graf-after--p">Bugs found in development, not production</li><li name="288a" id="288a" class="graf graf--li graf-after--li">Refactoring became possible (tests failed when things broke)</li><li name="17d5" id="17d5" class="graf graf--li graf-after--li">New developers understood what the code actually did</li><li name="5345" id="5345" class="graf graf--li graf-after--li">CI was slower but deployments were faster (less debugging)</li></ul><h3 name="1d6d" id="1d6d" class="graf graf--h3 graf-after--li">For fellow mock addicts</h3><p name="eeba" id="eeba" class="graf graf--p graf-after--h3">If your tests are all green but your app is on fire, ask yourself:</p><ol class="postList"><li name="8990" id="8990" class="graf graf--li graf-after--p">What are you actually testing — your code or your mocks?</li><li name="8e0c" id="8e0c" class="graf graf--li graf-after--li">If you deleted the implementation, would tests still pass?</li><li name="45c7" id="45c7" class="graf graf--li graf-after--li">Do your tests use the same objects as production?</li><li name="8d69" id="8d69" class="graf graf--li graf-after--li">Can a new developer understand what works from the tests?</li><li name="f7c3" id="f7c3" class="graf graf--li graf-after--li">When did you last run the actual app?</li></ol><h3 name="c866" id="c866" class="graf graf--h3 graf-after--li">The recovery</h3><p name="0e04" id="0e04" class="graf graf--p graf-after--h3">It took a solid day to fix our test suite. We went from 147 passing tests to 43. But those 43 tests actually tested something.</p><p name="294f" id="294f" class="graf graf--p graf-after--p">More importantly, when they passed, the app worked.</p><p name="4c1c" id="4c1c" class="graf graf--p graf-after--p">Green checkmarks that mean something. What a concept.</p><p name="b519" id="b519" class="graf graf--p graf-after--p">When I first heard that test-driven development is a good way to keep robo-coders on track I was excited. Then I heard they sometimes change the tests to make them pass, and now I realize that what you test is at least as important as the fact that you are testing.</p><h3 name="b1e2" id="b1e2" class="graf graf--h3 graf-after--p">The punchline</h3><p name="5078" id="5078" class="graf graf--p graf-after--h3">The best part? After fixing all the tests and removing the mocks, we found the original bug in five minutes. The Workflow class was missing a <code class="markup--code markup--p-code">to_dict()</code> method that the persistence layer expected.</p><p name="2a59" id="2a59" class="graf graf--p graf-after--p">One method. Five lines of code. Hidden by 147 “passing” tests.</p><p name="56cb" id="56cb" class="graf graf--p graf-after--p">Sometimes the best test framework is console.log and hope.</p><p name="0fa0" id="0fa0" class="graf graf--p graf-after--p graf--trailing">(Just kidding. But only barely.)</p></div></div></section><section name="1046" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="3cd6" id="3cd6" class="graf graf--p graf--leading"><em class="markup--em markup--p-em">Next in Building Piper Morgan: Building the MVP While Keeping the Dream Alive (or: How we documented features we’ll build “someday” without getting distracted)</em></p><p name="3589" id="3589" class="graf graf--p graf-after--p graf--trailing"><em class="markup--em markup--p-em">What’s your worst mocking disaster? When did 100% test coverage give you 0% confidence? Share your testing horror stories — misery loves company.</em></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@mediajunkie" class="p-author h-card">christian crumlish</a> on <a href="https://medium.com/p/3b3d6f3aeff1"><time class="dt-published" datetime="2025-08-08T14:16:04.863Z">August 8, 2025</time></a>.</p><p><a href="https://medium.com/@mediajunkie/when-your-tests-pass-but-your-app-fails-3b3d6f3aeff1" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 9, 2025.</p></footer></article></body></html>