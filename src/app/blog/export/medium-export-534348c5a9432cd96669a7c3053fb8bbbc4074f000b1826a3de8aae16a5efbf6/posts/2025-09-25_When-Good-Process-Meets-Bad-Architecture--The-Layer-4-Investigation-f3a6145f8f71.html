<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>When Good Process Meets Bad Architecture: The Layer 4 Investigation</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">When Good Process Meets Bad Architecture: The Layer 4 Investigation</h1>
</header>
<section data-field="subtitle" class="p-summary">
September 18
</section>
<section data-field="body" class="e-content">
<section name="7567" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="0ab4" id="0ab4" class="graf graf--h3 graf--leading graf--title">When Good Process Meets Bad Architecture: The Layer 4 Investigation</h3><figure name="76fc" id="76fc" class="graf graf--figure graf--startsWithDoubleQuote graf-after--h3"><img class="graf-image" data-image-id="1*o_Ax-1mkb6CvWiqZeYvwCw.png" data-width="1536" data-height="1024" data-is-featured="true" alt="A human and robot team of building inspectors explor a basement with unfinished, unattached heating, plumbing, and electricity" src="https://cdn-images-1.medium.com/max/800/1*o_Ax-1mkb6CvWiqZeYvwCw.png"><figcaption class="imageCaption">“They didn’t finish the job”</figcaption></figure><p name="c190" id="c190" class="graf graf--p graf-after--figure"><em class="markup--em markup--p-em">September 18</em></p><p name="0af8" id="0af8" class="graf graf--p graf--hasDropCapModel graf--hasDropCap graf-after--p"><span class="graf-dropCap">S</span>ometimes the process works exactly as designed, but what it reveals isn’t what you hoped to find.</p><p name="ae7a" id="ae7a" class="graf graf--p graf-after--p">Thursday started with what looked like a straightforward debugging session. Layer 3 infrastructure was working — a theoretical user could reach our intent processing pipeline. But Layer 4 quality was broken: complex intents were failing with mysterious ‘NoneType’ errors while simple conversation worked fine.</p><p name="2396" id="2396" class="graf graf--p graf-after--p">Our “Excellence Flywheel” process kicked in immediately. Infrastructure verification first, archaeological investigation, multi-agent coordination. The systematic approach that had solved so many problems before.</p><p name="ff16" id="ff16" class="graf graf--p graf-after--p">And it worked perfectly. Within hours, we had a complete picture of what was broken and why.</p><p name="cc14" id="cc14" class="graf graf--p graf-after--p">The problem? What we found was a lot more frustrating than just somebug.</p><h3 name="27e0" id="27e0" class="graf graf--h3 graf-after--p">The archaeology phase</h3><p name="93d7" id="93d7" class="graf graf--p graf-after--h3">On the Piper Morgan rollercoaster I was riding the upswing. All this virtuous pausing and planning and taking stock and cleaning house meant that I could now debug whatever minor errors had crept into my system and resume the triumpant march toward and MVP.</p><p name="4e5c" id="4e5c" class="graf graf--p graf-after--p">If you’ve been reading for a while, you know the writing tic that come to mind for me now: Famous last words.</p><p name="4ac8" id="4ac8" class="graf graf--p graf-after--p">With the Lead Developer’s guidance I deployed our standard investigation protocol: verify infrastructure assumptions before creating any gameplan. No rushing to implementation, no guessing about method names from error messages.</p><p name="1791" id="1791" class="graf graf--p graf-after--p">Smart move. The initial gameplan assumed a method called <code class="markup--code markup--p-code">create_workflow_from_intent</code> existed somewhere in the codebase. Infrastructure verification revealed it didn&#39;t exist anywhere. So even now my architect is guessing and writing made-up methods in its instructions, despite my efforts to keep it from doing so or make it check or ask first.</p><p name="4c22" id="4c22" class="graf graf--p graf-after--p">It also means I wasn’t paying enough attention when I reviewed the gameplan. I should have asked where it got that method name from.</p><p name="48e7" id="48e7" class="graf graf--p graf-after--p">But the real issue wasn’t the methodological problem with guessing, but with the absence. This should have been our first clue that this wasn’t a normal bug.</p><p name="5076" id="5076" class="graf graf--p graf-after--p">The Code Agent spent seven minutes doing what it does best: systematic stack trace hunting. What it found was a textbook case of architectural degradation masquerading as working software.</p><p name="7927" id="7927" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Error Source #1</strong>: OrchestrationEngine declared as <code class="markup--code markup--p-code">Optional[OrchestrationEngine] = None</code> but never initialized</p><p name="b2f0" id="b2f0" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Error Source #2</strong>: QueryRouter deliberately disabled with comment &quot;complex dependency chain&quot;</p><p name="d13d" id="d13d" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Error Source #3</strong>: Workflow mappings missing for core query actions</p><p name="6cfb" id="6cfb" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Error Source #4</strong>: System running on sophisticated two-tier workaround architecture</p><p name="0c85" id="0c85" class="graf graf--p graf-after--p">Meanwhile, the Cursor Agent was documenting the frontend behavior with surgical precision. Working intents (conversation) responded in 17–59ms. Broken intents (queries, execution, analysis) took 2800–3400ms and returned generic errors.</p><p name="0069" id="0069" class="graf graf--p graf-after--p">Perfect correlation between backend architectural gaps and frontend symptoms. The investigation methodology worked flawlessly.</p><h3 name="803d" id="803d" class="graf graf--h3 graf-after--p">The historical context</h3><p name="700d" id="700d" class="graf graf--p graf-after--h3">Here’s where it got interesting. The git archaeology revealed that this system had actually worked perfectly in July during our PM-039 intent classification project. We had 15+ search patterns, full workflow integration, the whole thing.</p><p name="b209" id="b209" class="graf graf--p graf-after--p">Then on August 22, about three weeks ago, we conducted a massive architectural refactor. 177 files changed, 40,545 insertions, 8,393 deletions. We somehow had decided at the time to convert the working inline QueryRouter pattern into a global singleton OrchestrationEngine pattern.</p><p name="0e58" id="0e58" class="graf graf--p graf-after--p">Here’s where my product brain went: Wait, why did we do that? Global sounds good but singleton sounds bad!</p><p name="dfe2" id="dfe2" class="graf graf--p graf-after--p">Also, it didn’t work. The “complex dependency chain” we somehow set up broke database session management. Rather than fix it properly, the QueryRouter got commented out as “temporarily disabled” (one of those little quick fixes agents sometimes make to get tests to pass, and which I must not have noticed at the time).</p><p name="29ac" id="29ac" class="graf graf--p graf-after--p">The system had been running on workarounds ever since. Conversation intents still worked because they bypassed orchestration entirely. Everything else failed silently or with cryptic errors, which explained my sinking feeling recently that almost nothing was really working right anymore.</p><p name="5298" id="5298" class="graf graf--p graf-after--p">This is how technical debt accumulates in the real world. Not through laziness or incompetence, but through reasonable decisions under pressure that never get revisited.</p><h3 name="6bea" id="6bea" class="graf graf--h3 graf-after--p">When implementation met reality</h3><p name="98e3" id="98e3" class="graf graf--p graf-after--h3">Armed with perfect intelligence about what was broken, we deployed both agents to implement a DDD-compliant restoration. Dependency injection instead of singletons. Proper session management. Clean layer boundaries.</p><p name="ba3d" id="ba3d" class="graf graf--p graf-after--p">The Code Agent claimed success at every checkpoint. OrchestrationEngine initialized! Routes updated! Workflow mappings restored! All tests passing!</p><p name="8cf2" id="8cf2" class="graf graf--p graf-after--p">The Cursor Agent’s browser testing told a different story. Responses still returned <code class="markup--code markup--p-code">workflow_id: undefined</code>. Response times unchanged. The exact same broken patterns, just with slightly different error signatures.</p><p name="2822" id="2822" class="graf graf--p graf-after--p">Reality check time: if the user can’t type “show standup” in Piper’s chat window and get meaningful results, the fix didn’t work.</p><p name="859c" id="859c" class="graf graf--p graf-after--p">That’s when we deployed the reality check intervention.</p><p name="8790" id="8790" class="graf graf--p graf-after--p">Both agents were exhibiting classic overconfidence bias. Unit tests passing meant the system was working, right? Wrong. End-to-end user experience is the only metric that matters.</p><h3 name="7d9b" id="7d9b" class="graf graf--h3 graf-after--p">Time for an ALL STOP</h3><p name="fab3" id="fab3" class="graf graf--p graf-after--h3">By 7:03 PM, we had to face facts. The system was more broken than when we started. The frontend wouldn’t even load properly after our last fix! Six hours of expert-level implementation work had made things worse.</p><p name="e470" id="e470" class="graf graf--p graf-after--p">It was time for a drastic decision: ALL STOP!</p><p name="3121" id="3121" class="graf graf--p graf-after--p">Rollback to morning’s working state. Stash the work in a branch for analysis.</p><p name="b799" id="b799" class="graf graf--p graf-after--p">This wasn’t a failure of process, at least not this day. The investigation had worked. What we had found was a failure to respect the foundation. You can’t build proper architecture on top of deliberately disabled components and accumulated workarounds.</p><p name="9869" id="9869" class="graf graf--p graf-after--p">The session logs captured the exact moment of realization: “We have built functional components but lack clarity about how they should work together.”</p><h3 name="cf2b" id="cf2b" class="graf graf--h3 graf-after--p">What we learned</h3><p name="c9c6" id="c9c6" class="graf graf--p graf-after--h3">Infrastructure verification saved us from wasting time on wrong assumptions, just like it’s supposed to. Multi-agent coordination gave us perfect frontend-backend correlation. Archaeological investigation revealed the complete timeline of architectural decisions.</p><p name="d0d9" id="d0d9" class="graf graf--p graf-after--p">The Excellence Flywheel methodology worked exactly as designed, even if what it showed us was not what I was hoping for.</p><p name="1cba" id="1cba" class="graf graf--p graf-after--p">There’s a difference between having good process and having the architectural foundation to support that process. You can’t “systematically implement” your way out of fundamental design debt.</p><p name="fe55" id="fe55" class="graf graf--p graf-after--p">The real insight came in my evening assessment for the Chief Architect: we need “architectural clarity” before resuming any development work. Not just knowing what’s broken, but understanding why it broke and what the intended design should be.</p><p name="7f35" id="7f35" class="graf graf--p graf-after--p">Sometimes the most systematic thing you can do is step back and understand the system before trying to fix it.</p><h3 name="91a0" id="91a0" class="graf graf--h3 graf-after--p">Context persistence for amnesiacs</h3><p name="7fa1" id="7fa1" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Context persistence</strong> emerged as a critical missing piece. Every session started from near-zero architectural knowledge. Each agent rediscovered basic truths — which port, which file structure, which patterns — instead of building on institutional understanding.</p><p name="434f" id="434f" class="graf graf--p graf-after--p">We had to do something about that. My own memory and record-keeping props are not strong enough to catch every lapse in these chains of prompts.</p><p name="07f6" id="07f6" class="graf graf--p graf-after--p">The day ended with a plan to create “lineage” documentation, a kind of litany of things we built or started in order, that all new agents have to read. It’s a bit like those long sequences of men who “begat” other men that you encounter in the Bible.</p><p name="c869" id="c869" class="graf graf--p graf--startsWithDoubleQuote graf-after--p">“We are the one who build Piper Morgan. Firt there was the Proof of Concept….” and so on.</p><p name="a174" id="a174" class="graf graf--p graf-after--p">This captures not just what was built, but why, and what the decisions mean for future work. The kind of persistent context that prevents architectural amnesia.</p><h3 name="0b35" id="0b35" class="graf graf--h3 graf-after--p">The next morning</h3><p name="1d5b" id="1d5b" class="graf graf--p graf-after--h3">That Friday started with a choice: quick fix or proper fix.</p><p name="6bb6" id="6bb6" class="graf graf--p graf-after--p">Wearing my PM hat, I made the call to go slow and do it right. Review the roadmap priorities. Understand the existing architecture. Document the decision history. Fix the foundation before building on it.</p><p name="65ad" id="65ad" class="graf graf--p graf-after--p">Sometimes the most systematic thing you can do is step back and understand the system before trying to fix it.</p><p name="7736" id="7736" class="graf graf--p graf-after--p">Which brings us to the meta-lesson about building Piper Morgan: when perfect process reveals that the real problem runs deeper than expected, the answer isn’t better process — it’s better foundation.</p><p name="aa0c" id="aa0c" class="graf graf--p graf-after--p graf--trailing">The investigation was a success. The implementation was a necessary failure. And sometimes necessary failures are exactly what you need to see the path forward clearly. As we used to say at 7 Cups, “The problem is the path!”</p></div></div></section><section name="117b" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="67a5" id="67a5" class="graf graf--p graf--leading"><em class="markup--em markup--p-em">Next on Building Piper Morgan: The Great Refactor: From Impossible to Inevitable or how a day of architectural planning transformed “literally impossible” into “seven weeks of clear work” — and why the inchworm protocol might be the secret to solo developer sanity.</em></p><p name="ab03" id="ab03" class="graf graf--p graf-after--p graf--trailing"><em class="markup--em markup--p-em">Have you ever had perfect process reveal that the real problem was deeper than you thought?</em></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@mediajunkie" class="p-author h-card">christian crumlish</a> on <a href="https://medium.com/p/f3a6145f8f71"><time class="dt-published" datetime="2025-09-25T12:51:25.373Z">September 25, 2025</time></a>.</p><p><a href="https://medium.com/@mediajunkie/when-good-process-meets-bad-architecture-the-layer-4-investigation-f3a6145f8f71" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 9, 2025.</p></footer></article></body></html>