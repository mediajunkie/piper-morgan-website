<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>The Day We Taught Piper to Summarize (Almost)</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">The Day We Taught Piper to Summarize (Almost)</h1>
</header>
<section data-field="subtitle" class="p-summary">
July 4
</section>
<section data-field="body" class="e-content">
<section name="33da" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="c7bf" id="c7bf" class="graf graf--h3 graf--leading graf--title">The Day We Taught Piper to Summarize (Almost)</h3><figure name="63d2" id="63d2" class="graf graf--figure graf--startsWithDoubleQuote graf-after--h3"><img class="graf-image" data-image-id="1*VmVREo_MEL3wGggpNwq4dQ.png" data-width="1536" data-height="1024" data-is-featured="true" alt="A robot student gives a book report" src="https://cdn-images-1.medium.com/max/800/1*VmVREo_MEL3wGggpNwq4dQ.png"><figcaption class="imageCaption">“Websters defines…”</figcaption></figure><p name="d945" id="d945" class="graf graf--p graf-after--figure"><em class="markup--em markup--p-em">July 4</em></p><p name="b083" id="b083" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">A tale of hidden infrastructure, session mysteries, and the importance of actually showing your work</em></p><p name="e944" id="e944" class="graf graf--p graf--hasDropCapModel graf--hasDropCap graf-after--p"><span class="graf-dropCap">P</span>icture this: UI Test 2.3 — “Document Summarization.” Should be simple, right? Upload a file, ask for a summary, get a summary. We had spent the entire previous work session wrestling with the workflow and finally realizing we needed to build out the SYNTHESIS function. We were ready to do it the right way. What could go wrong?</p><p name="1387" id="1387" class="graf graf--p graf-after--p">Everything, as it turns out. But in the most educational way possible.</p><h3 name="10e3" id="10e3" class="graf graf--h3 graf-after--p">Act 1: The syntax error that blocked everything</h3><p name="b1be" id="b1be" class="graf graf--p graf-after--h3">We started with the API server crashing on startup. The culprit? Two lonely backticks on line 23 of engine.py:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="javascript" name="4b30" id="4b30" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">from</span> services.<span class="hljs-property">integrations</span>.<span class="hljs-property">github</span>.<span class="hljs-property">github_agent</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">GitHubAgent</span><br /><span class="hljs-string">``</span><br />logger = structlog.<span class="hljs-title function_">get_logger</span>()</span></pre><p name="dd5d" id="dd5d" class="graf graf--p graf-after--pre">Those backticks. Just sitting there. Mocking us.</p><h3 name="2aa2" id="2aa2" class="graf graf--h3 graf-after--p">Act 2: The infrastructure we already had</h3><p name="d9bc" id="d9bc" class="graf graf--p graf-after--h3">After fixing the syntax error, we went hunting for document operations. I wondered if we needed to build a whole new system for summarization. Then Cursor Agent made a discovery:</p><p name="7e00" id="7e00" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">CA</strong>: “I found the exact location where workflow results are handled and the generic ‘Workflow completed successfully!’ message is generated”</p><p name="a94a" id="a94a" class="graf graf--p graf-after--p">But here’s the twist — we already HAD a complete document analysis system! Hidden in <code class="markup--code markup--p-code">services/analysis/</code> was a DocumentAnalyzer that could extract text from PDFs, call an LLM for summarization, and return structured results.</p><p name="df0b" id="df0b" class="graf graf--p graf-after--p">We’d been prepared to build something that already existed. Classic.</p><h3 name="0aea" id="0aea" class="graf graf--h3 graf-after--p">Act 3: Settling the great SYNTHESIS debate</h3><p name="c82c" id="c82c" class="graf graf--p graf-after--h3">The LLM insisted that “summarize this document” was a SYNTHESIS operation, not a QUERY. We had tried to fight it. We had considered forcing it. Then I had a moment of clarity:</p><blockquote name="25d3" id="25d3" class="graf graf--blockquote graf--hasDropCapModel graf--startsWithDoubleQuote graf-after--p">“Thanks, that helps me understand a lot better and I’m much more comfortable with ‘not fighting it.’ Learning, for me, often involved covering some ground a few times until it really sinks in.”</blockquote><p name="1a03" id="1a03" class="graf graf--p graf-after--blockquote">This led to a philosophical discussion about the nature of LLMs and intent classification. My lead developer clarified again that we weren’t fighting any learned behavior of Piper’s, but Claude (the LLM we were shopping out the analys to) was applying its own training. Summarization IS synthesis — you’re creating something new. The LLM was architecturally correct, and we were the ones being stubborn.</p><h3 name="984f" id="984f" class="graf graf--h3 graf-after--p">Act 4: The session ID mystery</h3><p name="8d0d" id="8d0d" class="graf graf--p graf-after--h3">Here’s where it got interesting. The file was uploaded. The workflow was created. But it kept failing with “No file ID found in workflow context.”</p><p name="d537" id="d537" class="graf graf--p graf-after--p">We traced through layers of code:</p><ul class="postList"><li name="1418" id="1418" class="graf graf--li graf-after--p">Intent enricher ✓</li><li name="e4a5" id="e4a5" class="graf graf--li graf-after--li">File resolver ✓</li><li name="7797" id="7797" class="graf graf--li graf-after--li">Workflow factory ✓</li><li name="516c" id="516c" class="graf graf--li graf-after--li">Session handling… ✗</li></ul><p name="5aa4" id="5aa4" class="graf graf--p graf-after--li">The session ID wasn’t being propagated! Files were uploaded with session IDs like <code class="markup--code markup--p-code">session_20250703_161508_10668</code>, but the workflows had no session ID at all.</p><p name="125f" id="125f" class="graf graf--p graf-after--p">I wrote “This makes sense as we have continued tests through restarts, etc. But in reality we will need to refer to docs from earlier sessions somehow.”</p><p name="c7d8" id="c7d8" class="graf graf--p graf-after--p">Thus turning a bug discovery into an architectural discussion.</p><h3 name="142e" id="142e" class="graf graf--h3 graf-after--p">Act 5: The multi-word pattern problem</h3><p name="14ea" id="14ea" class="graf graf--p graf-after--h3">Even after fixing session propagation, we hit another snag. The user said “Please summarize that pattern catalog file I just uploaded” but the file reference detector only matched patterns like “that file” or “that data file” — single words between “that” and “file”.</p><p name="a0cd" id="a0cd" class="graf graf--p graf-after--p">CA (Cursor Agent) caught this beautifully, explaining how the regex <code class="markup--code markup--p-code">\b(that \w+ file)\b</code> couldn&#39;t match &quot;pattern catalog&quot; because it&#39;s two words. One regex update later, and we were in business.</p><h3 name="c12d" id="c12d" class="graf graf--h3 graf-after--p">The moment of truth</h3><p name="8df6" id="8df6" class="graf graf--p graf-after--h3">Finally, (almost) everything clicked:</p><ol class="postList"><li name="c164" id="c164" class="graf graf--li graf-after--p">✅ File uploaded with session</li><li name="0d0a" id="0d0a" class="graf graf--li graf-after--li">✅ Intent classified as SYNTHESIS</li><li name="5629" id="5629" class="graf graf--li graf-after--li">✅ Session ID propagated</li><li name="2a83" id="2a83" class="graf graf--li graf-after--li">✅ File reference detected</li><li name="413c" id="413c" class="graf graf--li graf-after--li">✅ File resolved to ID</li><li name="ca99" id="ca99" class="graf graf--li graf-after--li">✅ Analysis completed</li><li name="149b" id="149b" class="graf graf--li graf-after--li">✅ “Workflow completed successfully!”</li><li name="1d12" id="1d12" class="graf graf--li graf-after--li">❓ But… where’s the summary?</li></ol><h3 name="0baa" id="0baa" class="graf graf--h3 graf-after--li">Amusing interlude</h3><p name="7573" id="7573" class="graf graf--p graf-after--h3">At one point, CA referenced some blog posts about this exact issue. I asked where it was finding the blog post.</p><p name="fa6a" id="fa6a" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">CA</strong>: The blog posts I was referring to are pm011-blog-post.md and pm011-blog-post-claude-pov!.md in your Downloads folder.</p><p name="7dcc" id="7dcc" class="graf graf--p graf-after--p">I didn’t recall letting it look in that folder, but points for doing the extra reading! Even our AI assistant was learning from its own history.</p><h3 name="c6b5" id="c6b5" class="graf graf--h3 graf-after--p">The lesson</h3><p name="0adf" id="0adf" class="graf graf--p graf-after--h3">We succeeded in making the document summarization pipeline work end-to-end. The workflow completes successfully. But there’s no actual summary displayed — just a success message.</p><p name="3860" id="3860" class="graf graf--p graf-after--p">The bots were ready to declare victory. The human (me) told them that if I don’t actually get to see the summary then the feature is still not working.</p><p name="0f63" id="0f63" class="graf graf--p graf-after--p">It’s a perfect metaphor for software development: you can have all the pieces working perfectly, but if you don’t show the tree to the user, did it really fall?</p><h3 name="952c" id="952c" class="graf graf--h3 graf-after--p">Tomorrow’s adventure</h3><p name="a4b8" id="a4b8" class="graf graf--p graf-after--h3">The summary is there, somewhere in the workflow context. The response formatting we added should extract it. But something’s not quite right. Maybe it’s the file type detection (why was markdown analyzed as a CSV?). Maybe the formatting code isn’t being hit. Maybe the summary is in a different field than expected.</p><p name="0333" id="0333" class="graf graf--p graf-after--p">That’s tomorrow’s mystery. Today, we celebrate that we can upload a file, reference it naturally, and have it analyzed by an LLM. The pipeline works. We just need to show our work.</p><p name="6205" id="6205" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">My parting (lazy) wisdom</strong>: “Let’s also make a note down the road (probably post-MVP) to make error messages that speak to what part of a process actually failed, in some natural language way.”</p><p name="5050" id="5050" class="graf graf--p graf-after--p graf--trailing">Indeed. “TASK_FAILED” helps no one. Happy Fourth of July! Today we celebrated independence from generic success messages (almost).</p></div></div></section><section name="fdc6" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="2959" id="2959" class="graf graf--p graf--leading"><em class="markup--em markup--p-em">Next on Building Piper Morgan: The Zeno’s Paradox of Debugging, or how I spent a weekend on one issue with Piper.</em></p><p name="ce3f" id="ce3f" class="graf graf--p graf-after--p graf--trailing"><em class="markup--em markup--p-em">Have you ever built something that seemed to work, only to find out it was actually still rather useless? I want to hear all about it!</em></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@mediajunkie" class="p-author h-card">christian crumlish</a> on <a href="https://medium.com/p/437a3ec04316"><time class="dt-published" datetime="2025-07-30T13:56:23.560Z">July 30, 2025</time></a>.</p><p><a href="https://medium.com/@mediajunkie/the-day-we-taught-piper-to-summarize-almost-437a3ec04316" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 9, 2025.</p></footer></article></body></html>